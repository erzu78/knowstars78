!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("kr-ad-sys requires a window with document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function n(){f&&clearTimeout(f);try{$(document).ajaxError(function(t,e,n,r){if(console.log(t,e,n,r),"ajaxError"===t.type)try{}catch(a){}})}catch(t){f=setTimeout(function(){n()},200)}}function r(t,e){d(t)?o(t,e):c(t,e)}function a(t,e){d(t)?o(t,e,!0):c(t,e,!0)}function i(t,e){var n=$(t).data("kr-showcase-id"),a=function(n,r){e&&e(n,r),$(t).html(n)};n?r(n,a):a("")}function o(t,e,n){s(t,e,!0,n)}function c(t,e,n){s(t,e,!1,n)}function u(t,e,n){var r=t;Object.keys(e).forEach(function(t){var a=e[t].type,i=e[t].size,o=n[t];o||(o="img"===a?"http://placekitten.com/"+i[0]+"/"+i[1]:"示例文字"),r=r.replace("{{"+t+"}}",o)});return r}function s(t,e,n,r){function a(t){var e=t&&t.ad,n=e&&e.materiels&&e.materiels[0],r=e.template&&e.template.definition,a=n&&n.data;if(!a)return e;try{a=JSON.parse(a),r=JSON.parse(r),Object.keys(a).forEach(function(t){var e=t.split("#"),i=e[0],o=e[1],c=/http(s?):\/\/.+$/,u=r[i]&&r[i].type,s=a[t],d=o&&s.match(c)&&"img"!==u;d&&(a[t]=s.indexOf("?")>-1?s+"&st_index="+o:s+"?st_index="+o,n.data=JSON.stringify(a))})}catch(i){}return e}var i=n?y:m;try{}catch(o){}return n?void $.ajax({url:i+"/"+p("key"),dataType:"jsonp",success:function(t){var n=t.content,r=JSON.parse(t.definition),a=t.materielData||{},i=u(n,r,a);e&&e(i||"")},error:function(){e&&e("",!0)}}):void $.ajax({url:i,data:{pids:t},dataType:"jsonp",success:function(t){if(t=t.data||[],!t.length)return e&&e("");if(r){var n=t&&t[0];return a(n),e&&e(t[0]||"")}try{var n=t&&t[0]&&t[0].ad,i=n.materiel_data&&JSON.parse(n.materiel_data)||{}}catch(o){var i={}}if(i&&i._extra_statistics){var c=i._extra_statistics.replace(/https:\/\/36kr.com\/pp\/ap\/click\?pid=.+&r=(.+)/,function(t,e){return decodeURIComponent(e)});t[0].html+='<img style="display:none" src="'+c+'" />'}e&&e(t[0].html||"")},error:function(){e&&e("",!0)}})}function d(t){var e=p("key"),n=p("adSysPreviewIds")||"",r=n.split(",").indexOf(t+"")!==-1;return e&&r}function p(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(e);return null!=n?decodeURIComponent(n[2]):null}var f,l={},m="//36kr.com/pp/api/ap/plan",y="//ad.corp.36kr.com/preview";return n(),l.renderByDom=i,l.getHTML=r,l.getALL=a,e||(window.KrAdLoader=l),l});